{% import (
  "github.com/kyleu/loadtoad/app"
  "github.com/kyleu/loadtoad/app/controller/cutil"
  "github.com/kyleu/loadtoad/app/loadtoad"
  "github.com/kyleu/loadtoad/app/loadtoad/har"
  "github.com/kyleu/loadtoad/app/util"
  "github.com/kyleu/loadtoad/views/components"
  "github.com/kyleu/loadtoad/views/layout"
  "github.com/kyleu/loadtoad/views/vhar"
) %}

{% code type Detail struct {
  layout.Basic
  Workflow *loadtoad.Workflow
  Entries har.Entries
} %}

{% func (p *Detail) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <div class="right"><a href="#modal-workflow"><button type="button">JSON</button></a></div>
    {%= components.JSONModal("workflow", "Workflow", p.Workflow, 3) %}
    <h3>{%= components.SVGRefIcon(`sitemap`, ps) %} {%s p.Workflow.Title() %}</h3>
    <div class="mt">
      <a href="{%s p.Workflow.WebPath() %}/run?ok=true"><button>Run</button></a>
      {%- if len(p.Workflow.Replacements) > 0 -%}
      <a href="{%s p.Workflow.WebPath() %}/run"><button>Run w/ Options</button></a>
      {%- endif -%}
    </div>
  </div>
  <div class="card">
    <h3>{%= components.SVGRefIcon(`play`, ps) %} {%d len(p.Entries) %} {%s util.StringPluralMaybe("Request", len(p.Entries)) %}</h3>
    <div class="mt">
      <ul class="accordion">
        {%- for i, e := range p.Entries -%}
        {%- code e = e.Cleaned() -%}
        <li>
          <input id="accordion-entry-{%d i %}" type="checkbox" hidden />
          <label for="accordion-entry-{%d i %}">
            {%= vhar.RenderEntryOptions(i, e, false) %}
            {%= components.ExpandCollapse(3, ps) %} {%s e.String() %}
            <div class="clear"></div>
          </label>
          <div class="bd">
            {%= vhar.RenderEntry(i, e, ps) %}
          </div>
          {%= vhar.RenderEntryModals(i, e, false) %}
        </li>
        {%- endfor -%}
      </ul>
    </div>
  </div>
{% endfunc %}
