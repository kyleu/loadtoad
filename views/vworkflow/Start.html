{% import (
  "github.com/kyleu/loadtoad/app"
  "github.com/kyleu/loadtoad/app/controller/cutil"
  "github.com/kyleu/loadtoad/app/loadtoad"
  "github.com/kyleu/loadtoad/app/loadtoad/har"
  "github.com/kyleu/loadtoad/views/components"
  "github.com/kyleu/loadtoad/views/layout"
) %}

{% code type Start struct {
  layout.Basic
  Workflow *loadtoad.Workflow
  Entries har.Entries
  Channel string
  Path string
} %}

{% func (p *Start) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <div class="right"><a href="#modal-workflow"><button type="button">JSON</button></a></div>
    {%= components.JSONModal("workflow", "Workflow", p.Workflow, 3) %}
    <h3>{%= components.SVGRefIcon(`sitemap`, ps) %} {%s p.Workflow.Title() %} Results</h3>
    <div class="mt">
      {%- if len(p.Entries) == 0 -%}
      <div><em>no entries</em></div>
      {%- endif -%}
    </div>
    <div id="results" class="mt">
      <div>
        <strong>{%d len(p.Entries) %}</strong> total requests.
        <strong class="successes">0</strong> succeeded and <strong class="failures">0</strong> failed in <strong class="elapsed">0ms</strong>.
      </div>
      <div class="mt"><em class="status">Running...</em></div>
      <div class="logs"></div>
    </div>
  </div>
  {%- for idx, e := range p.Entries -%}
  {%= entryPlaceholder(idx, e, ps) %}
  {%- endfor -%}
  {%= startScript(p.Channel, p.Path) %}
{% endfunc %}

{% func entryPlaceholder(idx int, ent *har.Entry, ps *cutil.PageState) %}
  <div id="entry-placeholder-{%d idx %}" class="card">
    <h3>{%= components.SVGRefIcon(`file`, ps) %}{%s ent.String() %}</h3>
    <div class="clear"></div>
    <div class="mts details">
      <em>pending...</em>
    </div>
    <div class="logs">
    </div>
  </div>
{% endfunc %}
